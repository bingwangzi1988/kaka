//Ext.ux.FunctionGrid=Ext.extend(Ext.grid.GridPanel,{region:'center',margins:'5 5 5 5',viewConfig:{forceFit:true},loadMask:true,root:'root',dataId:'id',totalProperty:'total',remoteSort:false,formWidth:600,formHeight:400,searchColumn:4,pageSize:20,initComponent:function(a){var b=new Array();var c=new Array();b[0]={name:this.dataId};for(var i=1;i<this.cmRender.length;i++){b[i]={name:this.cmRender[i][2]};c[i-1]={header:this.cmRender[i][0],sortable:this.cmRender[i][1],dataIndex:this.cmRender[i][2]};if(this.cmRender[i][3]!=undefined){c[i-1][renderer]=this.cmRender[i][3]}}var d=new Ext.data.JsonReader({root:this.root,id:this.dataId,totalProperty:this.totalProperty,fields:b});var e=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:_contextPath_+'/'+this.listAction+'.action'}),remoteSort:this.remoteSort,reader:d});this.colModel=new Ext.grid.ColumnModel(c);this.store=e;delete this.cmRender;var f=new Ext.FormPanel({labelWidth:75,labelAlign:'right',url:_contextPath_+'/'+this.saveAction+'.action',frame:true,bodyStyle:'padding:5px 5px 0',items:this.formSet});var g=new Ext.Window({layout:'fit',width:this.formWidth,height:this.formHeight,closable:true,modal:true,closeAction:'hide',plain:true,items:[f],buttons:[{text:'保存',handler:this.saveForm,scope:this},{text:'取消',handler:function(){g.hide()}}]});this.win1=g;var h=new Ext.PagingToolbar({pageSize:this.pageSize,store:e,plugins:[new Ext.ux.PageSizePlugin(),new Ext.ux.ProgressBarPager()],displayInfo:true,items:['->','-',{text:'增加',iconCls:'add',handler:this.addObject,scope:this},'-',{text:'修改',iconCls:'edit',handler:this.editObject,scope:this},'-',{text:'删除',iconCls:'remove',handler:this.deleteObject,scope:this}]});this.bbar=h;Ext.apply(this,a);Ext.ux.FunctionGrid.superclass.initComponent.call(this);e.load();var j=[this];if(this.searchSet!=undefined){var k=new Array();for(var l=0;l<this.searchColumn;l++){k[l]={columnWidth:1/this.searchColumn,layout:'form',items:[]}}for(var m=0;m<this.searchSet.length;m++){var n=m%this.searchColumn;k[n].items.push(this.searchSet[m])}var o=28*Math.ceil(this.searchSet.length/this.searchColumn)+75;var p=new Ext.FormPanel({labelWidth:60,height:o,title:"搜索",region:'north',labelAlign:'right',url:_contextPath_+'/'+this.searchAction+'.action',frame:true,collapsible:true,bodyStyle:'padding:5px 5px 0',buttonAlign:"center",items:{layout:'column',items:k},buttons:[{text:'查询',tooltip:'查询',handler:function(){if(p.form.isValid()){e.on('beforeload',function(){e.baseParams=p.getForm().getFieldValues(true)});e.load({params:{start:0,limit:this.pageSize}})}}},{text:'重置',tooltip:'重置',handler:function(){p.form.reset()}}]});j=[p,this]}new Ext.Viewport({layout:'border',items:[j]})},addObject:function(){this.win1.setTitle(this.addTitle);this.win1.show();this.win1.items.get(0).form.reset()},editObject:function(){var c=this.getSelectionModel().getSelections();if(c.length>0){var d=c[0].id;Ext.Ajax.request({url:_contextPath_+'/'+this.initEditAction+'.action?'+this.dataId+"="+d,success:intForm,failure:function(a){var b=Ext.util.JSON.decode(a.responseText);Ext.Msg.alert('提示',b.msg)},scope:this});this.win1.setTitle(this.editTitle);this.win1.show();function intForm(o){var a=Ext.util.JSON.decode(o.responseText);this.win1.items.get(0).form.setValues(a)}}else{Ext.MessageBox.show({title:'警告',msg:"请选择一个对象",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}},deleteObject:function(){var c=this.getSelectionModel().getSelections();if(c.length>0)Ext.MessageBox.confirm('消息','确认要删除所选对象?',doDelObject,this);else Ext.MessageBox.show({title:'警告',msg:"请选择要删除的对象",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});function doDelObject(b){if(b=='yes'){if(this.getSelectionModel().hasSelection()){var c=new Array();var d=this.getSelectionModel().getSelections();for(var i=0,len=d.length;i<len;i++){c[c.length]=d[i].id}Ext.Ajax.request({url:_contextPath_+'/'+this.deleteAction+'.action?'+this.dataId+"="+c.toString(),success:onSuccessDel,failure:function(a){alert(a.responseText)},scope:this})}}}function onSuccessDel(o){Ext.MessageBox.show({title:'消息',msg:"删除对象成功",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});this.store.reload()}},saveForm:function(){if(this.win1.items.get(0).form.isValid()){this.win1.items.get(0).form.submit({success:function(a,b){this.win1.hide();this.store.reload()},scope:this,waitTitle:"请稍后",waitMsg:"数据保存中……"})}}});
Ext.ux.FunctionGrid=Ext.extend(Ext.grid.GridPanel,{region:'center',margins:'5 5 5 5',viewConfig:{forceFit:true},loadMask:true,root:'root',dataId:'id',totalProperty:'total',remoteSort:false,formWidth:600,formHeight:400,searchColumn:4,pageSize:20,initComponent:function(a){var b=new Array();var c=new Array();b[0]={name:this.dataId};for(var i=1;i<this.cmRender.length;i++){b[i]={name:this.cmRender[i][2]};c[i-1]={header:this.cmRender[i][0],sortable:this.cmRender[i][1],dataIndex:this.cmRender[i][2]};if(this.cmRender[i][3]!=undefined){c[i-1][renderer]=this.cmRender[i][3]}}var d=new Ext.data.JsonReader({root:this.root,id:this.dataId,totalProperty:this.totalProperty,fields:b});var e=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:_contextPath_+'/'+this.listAction}),remoteSort:this.remoteSort,reader:d});this.colModel=new Ext.grid.ColumnModel(c);this.store=e;delete this.cmRender;var f=new Ext.FormPanel({labelWidth:75,labelAlign:'right',url:_contextPath_+'/'+this.saveAction+'.action',frame:true,bodyStyle:'padding:5px 5px 0',items:this.formSet});var g=new Ext.Window({layout:'fit',width:this.formWidth,height:this.formHeight,closable:true,modal:true,closeAction:'hide',plain:true,items:[f],buttons:[{text:'保存',handler:this.saveForm,scope:this},{text:'取消',handler:function(){g.hide()}}]});this.win1=g;var h=new Ext.PagingToolbar({pageSize:this.pageSize,store:e,plugins:[new Ext.ux.PageSizePlugin(),new Ext.ux.ProgressBarPager()],displayInfo:true,items:['->','-',{text:'增加',iconCls:'add',handler:this.addObject,scope:this},'-',{text:'修改',iconCls:'edit',handler:this.editObject,scope:this},'-',{text:'删除',iconCls:'remove',handler:this.deleteObject,scope:this}]});this.bbar=h;Ext.apply(this,a);Ext.ux.FunctionGrid.superclass.initComponent.call(this);e.load();var j=[this];if(this.searchSet!=undefined){var k=new Array();for(var l=0;l<this.searchColumn;l++){k[l]={columnWidth:1/this.searchColumn,layout:'form',items:[]}}for(var m=0;m<this.searchSet.length;m++){var n=m%this.searchColumn;k[n].items.push(this.searchSet[m])}var o=28*Math.ceil(this.searchSet.length/this.searchColumn)+75;var p=new Ext.FormPanel({labelWidth:60,height:o,title:"搜索",region:'north',labelAlign:'right',url:_contextPath_+'/'+this.searchAction+'.action',frame:true,collapsible:true,bodyStyle:'padding:5px 5px 0',buttonAlign:"center",items:{layout:'column',items:k},buttons:[{text:'查询',tooltip:'查询',handler:function(){if(p.form.isValid()){e.on('beforeload',function(){e.baseParams=p.getForm().getFieldValues(true)});e.load({params:{start:0,limit:this.pageSize}})}}},{text:'重置',tooltip:'重置',handler:function(){p.form.reset()}}]});j=[p,this]}new Ext.Viewport({layout:'border',items:[j]})},addObject:function(){this.win1.setTitle(this.addTitle);this.win1.show();this.win1.items.get(0).form.reset()},editObject:function(){var c=this.getSelectionModel().getSelections();if(c.length>0){var d=c[0].id;Ext.Ajax.request({url:_contextPath_+'/'+this.initEditAction+'.action?'+this.dataId+"="+d,success:intForm,failure:function(a){var b=Ext.util.JSON.decode(a.responseText);Ext.Msg.alert('提示',b.msg)},scope:this});this.win1.setTitle(this.editTitle);this.win1.show();function intForm(o){var a=Ext.util.JSON.decode(o.responseText);this.win1.items.get(0).form.setValues(a)}}else{Ext.MessageBox.show({title:'警告',msg:"请选择一个对象",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}},deleteObject:function(){var c=this.getSelectionModel().getSelections();if(c.length>0)Ext.MessageBox.confirm('消息','确认要删除所选对象?',doDelObject,this);else Ext.MessageBox.show({title:'警告',msg:"请选择要删除的对象",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});function doDelObject(b){if(b=='yes'){if(this.getSelectionModel().hasSelection()){var c=new Array();var d=this.getSelectionModel().getSelections();for(var i=0,len=d.length;i<len;i++){c[c.length]=d[i].id}Ext.Ajax.request({url:_contextPath_+'/'+this.deleteAction+'.action?'+this.dataId+"="+c.toString(),success:onSuccessDel,failure:function(a){alert(a.responseText)},scope:this})}}}function onSuccessDel(o){Ext.MessageBox.show({title:'消息',msg:"删除对象成功",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});this.store.reload()}},saveForm:function(){if(this.win1.items.get(0).form.isValid()){this.win1.items.get(0).form.submit({success:function(a,b){this.win1.hide();this.store.reload()},scope:this,waitTitle:"请稍后",waitMsg:"数据保存中……"})}}});